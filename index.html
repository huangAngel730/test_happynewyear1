<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 丙午马年新春祝福</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // 自动注入 GitHub Pages 基础地址（由本地仓库检测填充）
        // 如果部署到了 GitHub Pages，这里会被替换为类似：
        // window.__SHARE_BASE__ = 'https://username.github.io/repo';
        window.__SHARE_BASE__ = 'https://huangAngel730.github.io/test_happynewyear1';
    </script>
    <!-- Google Fonts for diverse styles -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;700&family=ZCOOL+KuaiLe&family=Orbitron:wght@500&family=Press+Start+2P&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
</head>
<body class="style-china"> <!-- 默认国风 -->

    <!-- 氛围背景层：柔和光斑与网格 -->
    <div class="ambient">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="grid-overlay"></div>
    </div>

    <!-- 入口引导 -->
    <section class="entry-overlay" id="entryOverlay" aria-label="进入体验">
        <div class="entry-box">
            <p class="entry-kicker">马年限定体验</p>
            <h1>你准备好了吗？</h1>
            <p class="entry-note">点击开始，将解锁音乐与国风主题，随后可自由切换风格。</p>
            <button class="entry-btn" onclick="startExperience()">开始旅程</button>
        </div>
    </section>

    <!-- 风格切换器 -->
    <nav class="theme-switcher">
        <button class="theme-btn" data-theme="style-china" onclick="switchTheme('style-china')">🏮 传统国风</button>
        <button class="theme-btn" data-theme="style-simple" onclick="switchTheme('style-simple')">🌿 简约清新</button>
        <button class="theme-btn" data-theme="style-cute" onclick="switchTheme('style-cute')">🦄 活泼卡通</button>
        <button class="theme-btn" data-theme="style-tech" onclick="switchTheme('style-tech')">🚀 科技未来</button>
        <button class="theme-btn" data-theme="style-warm" onclick="switchTheme('style-warm')">🧧 温馨治愈</button>
        <button class="theme-btn" data-theme="style-pixel" onclick="switchTheme('style-pixel')">🕹️ 像素复古</button>
    </nav>

    <!-- 音乐控制悬浮球 -->
    <div class="music-controls hover-trigger">
        <div class="music-icon" id="musicToggle">🎵</div>
        <div class="control-panel">
            <button id="playPauseBtn">暂停</button>
            <button id="nextTrackBtn">切歌</button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5">
        </div>
    </div>

    <!-- 音乐提示（自动播放受阻时显示） -->
    <div id="musicPrompt" class="music-prompt" onclick="userEnableMusic()">🔊 点击播放音乐</div>
    
    <!-- 隐藏的音频元素 -->
    <audio id="bgm" loop preload="auto" autoplay playsinline>
        <!-- 默认源，JS会动态修改 -->
        <source src="https://music.163.com/song/media/outer/url?id=496527237.mp3" type="audio/mpeg">
    </audio>

    <!-- 主要内容区 -->
    <main class="container">
        <!-- 马年视觉元素 (SVG绘制，确保无外部依赖) -->
        <div class="visual-center">
            <div class="horse-wrapper">
                <!-- 国风剪纸马 -->
                <svg class="horse-svg china-horse" viewBox="0 0 100 100">
                    <path d="M20,60 Q30,40 50,30 T80,40 L90,60 L80,80 L50,90 L20,80 Z" fill="var(--primary-color)" />
                    <text x="50" y="65" text-anchor="middle" fill="gold" font-size="30">马</text>
                    <title>剪纸骏马</title>
                </svg>

                <!-- 科技数字马 -->
                <div class="tech-horse-container">
                    <div class="tech-circle"></div>
                    <div class="tech-text">2026<br>HORSE</div>
                </div>

                <!-- 卡通小马 -->
                <div class="cute-horse-container">
                    <div class="cute-head">🐴</div>
                </div>

                <!-- 像素马 -->
                <div class="pixel-horse-container" aria-label="像素马">▥▥<br>▥█▥<br>▥▥</div>
            </div>
        </div>

        <div class="fu-badge" id="fuBadge" aria-label="点福得祝福">福</div>

        <!-- 标题 -->
        <h1 class="main-title">
            <span class="year">2026</span>
            <span class="zodiac">丙午马年</span>
            <span class="greeting-text">新春快乐</span>
        </h1>
        <p class="tagline reveal">借鉴优秀网页的灵感，用国风与未来感为你送上沉浸式新春祝福。</p>

        <!-- 场景切换器：不同场景生成对应祝福 -->
        <div class="scenario-switcher reveal" aria-label="选择祝福场景">
            <button class="scenario-btn active" data-scenario="general" onclick="switchScenario('general')">通用</button>
            <button class="scenario-btn" data-scenario="career" onclick="switchScenario('career')">事业</button>
            <button class="scenario-btn" data-scenario="study" onclick="switchScenario('study')">学业</button>
            <button class="scenario-btn" data-scenario="health" onclick="switchScenario('health')">健康</button>
            <button class="scenario-btn" data-scenario="family" onclick="switchScenario('family')">家庭</button>
            <button class="scenario-btn" data-scenario="wealth" onclick="switchScenario('wealth')">财富</button>
            <button class="scenario-btn" data-scenario="travel" onclick="switchScenario('travel')">出行</button>
            <button class="scenario-btn" data-scenario="friends" onclick="switchScenario('friends')">友情</button>
        </div>

        <div class="status-pills reveal">
            <button class="pill" data-action-pill="start">⚡ 即刻开跑</button>
            <button class="pill" data-action-pill="listen">🎧 沉浸聆听</button>
            <button class="pill" data-action-pill="inspire">🪄 灵感随心</button>
        </div>

        <div class="pixel-hud" id="pixelHud" aria-label="像素收集进度" style="display:none;">
            <span class="pixel-label">福袋进度</span>
            <span id="pixelCount">0/5</span>
        </div>

        <!-- 祝福语卡片 -->
        <div class="wish-card reveal" aria-live="polite">
            <p id="wishText" class="typing-effect">策马奔腾赴前程，春风得意马蹄疾！祝您2026年万事如意！</p>
            <div class="action-buttons">
                <button class="action-btn" onclick="generateWish(true, true)">✨ 生成祝福</button>
                <button class="action-btn" onclick="toggleEdit()">✍ 自定义</button>
                <button class="action-btn" onclick="copyWish()">📋 复制文本</button>
                <button class="action-btn" onclick="copyPageLink()">🔗 分享网页</button>
                <button class="action-btn ghost" onclick="openGuide()">❔ 使用指南</button>
                <button class="action-btn ghost" onclick="openGameOverlay()">🎮 跨年小游戏</button>
            </div>
            <div id="customWishArea" style="display:none; margin-top:10px;">
                <input type="text" id="customInput" placeholder="输入您的祝福..." style="width:70%; padding:5px;">
                <button onclick="confirmCustomBase()">确认</button>
            </div>
        </div>

        <section class="highlight-meta reveal" aria-label="氛围与进度">
            <div class="progress-track">
                <div class="progress-label-row">
                    <div class="progress-label">祝福能量</div>
                    <div class="progress-value" id="energyNumber">0%</div>
                </div>
                <div class="progress-bar">
                    <span class="progress-fill" id="energyFill"></span>
                </div>
                <small class="progress-hint">灵感来自优秀站点的发光进度条，随主题变色。</small>
            </div>
        </section>

        <section class="info-grid reveal" aria-label="今年亮点">
            <article class="info-card">
                <div class="card-top">福气指数</div>
                <div class="card-body">
                    <div class="counter" id="fortuneCounter" aria-live="polite">0%</div>
                    <p>互动越多，福气越高，从 0% 起步。</p>
                </div>
            </article>
            <article class="info-card">
                <div class="card-top">心愿达成</div>
                <div class="card-body">
                    <div class="counter" data-counter data-target="26" data-suffix="/26">0/26</div>
                    <p>小目标稳步完成，迎接惊喜。</p>
                </div>
            </article>
            <article class="info-card">
                <div class="card-top">活力时刻</div>
                <div class="card-body">
                    <div class="counter" data-counter data-target="520">0</div>
                    <p>保持热爱与速度，策马扬鞭向前。</p>
                </div>
            </article>
        </section>

        <section class="deep-wishes reveal" aria-label="分场景祝福">
            <div class="section-head">
                <h2>分场景祝福</h2>
                <p>下滑查看通用、事业、健康、家庭、财富祝愿，可一键切换句子，随风格同步。</p>
            </div>
            <div class="deep-grid">
                <article class="deep-card" data-deep-key="general">
                    <div class="deep-title">通用祝愿 <button class="deep-next" data-deep-key="general">换一条</button></div>
                    <ul class="deep-list"></ul>
                </article>
                <article class="deep-card" data-deep-key="career">
                    <div class="deep-title">事业腾飞 <button class="deep-next" data-deep-key="career">换一条</button></div>
                    <ul class="deep-list"></ul>
                </article>
                <article class="deep-card" data-deep-key="health">
                    <div class="deep-title">健康平安 <button class="deep-next" data-deep-key="health">换一条</button></div>
                    <ul class="deep-list"></ul>
                </article>
                <article class="deep-card" data-deep-key="family">
                    <div class="deep-title">家庭团圆 <button class="deep-next" data-deep-key="family">换一条</button></div>
                    <ul class="deep-list"></ul>
                </article>
                <article class="deep-card" data-deep-key="fortune">
                    <div class="deep-title">财富顺遂 <button class="deep-next" data-deep-key="fortune">换一条</button></div>
                    <ul class="deep-list"></ul>
                </article>
            </div>
        </section>
    </main>

    <!-- 飘落物容器 -->
    <div id="falling-container"></div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- 使用指南模态框 -->
    <div id="guideModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeGuide()">×</span>
            <h2>🧧 使用指南</h2>
            <ul>
                <li><strong>切换风格</strong>：点击顶部按钮切换 国风/科技/卡通 风格。</li>
                <li><strong>背景音乐</strong>：左下角悬浮球控制音乐播放/暂停及音量。</li>
                <li><strong>互动特效</strong>：点击页面任意空白处触发特效（红包/光效/糖果）。</li>
                <li><strong>自定义</strong>：修改HTML内的JS配置区即可替换祝福语。</li>
            </ul>
        </div>
        <div class="modal-footer">
            <button onclick="closeGuide()">我知道了</button>
        </div>
    </div>

    <!-- 跨年小游戏全屏弹层 -->
    <div id="gameOverlay" class="game-overlay" aria-modal="true" role="dialog" aria-label="跨年小游戏">
        <div class="game-panel">
            <div class="game-header">
                <h2>🎮 跨年小游戏</h2>
                <span class="close-btn" onclick="closeGameOverlay()">×</span>
            </div>
            <p id="gameDescription" class="game-desc">点击开始，随机体验接福袋 / 点灯笼 / 烟花快点三款轻量小游戏。</p>
            <div class="game-info">
                <span class="game-badge">模式：<strong id="gameMode">待选择</strong></span>
                <span class="game-badge">得分：<strong id="gameScore">0</strong></span>
                <span class="game-badge">时间：<strong id="gameTimer">--</strong>s</span>
                <span class="game-badge">生命：<strong id="gameLives">3</strong></span>
                <span class="game-badge">连击：<strong id="gameCombo">0</strong>x</span>
            </div>
            <div id="gameArea" class="game-area" tabindex="0"></div>
            <div class="game-actions">
                <button class="action-btn" onclick="startRandomGame()">▶ 开始</button>
                <button class="action-btn ghost" onclick="closeGameOverlay()">退出</button>
            </div>
            <p class="game-hint">提示：竖屏体验最佳，移动端用左右滑动/轻点，桌面可用左右键。</p>
        </div>
    </div>

    <!-- 脚本引用 -->
    <script src="script.js"></script>
</body>
</html>